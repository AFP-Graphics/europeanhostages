!function(){"use strict";var e="undefined"==typeof window?global:window;if("function"!=typeof e.require){var t={},a={},r={}.hasOwnProperty,n={},o=function(e,t){var a=0;t&&(t.indexOf(!1)&&(a="components/".length),t.indexOf("/",a)>0&&(t=t.substring(a,t.indexOf("/",a))));var r=n[e+"/index.js"]||n[t+"/deps/"+e+"/index.js"];return r?"components/"+r.substring(0,r.length-".js".length):e},s=function(){var e=/^\.\.?(\/|$)/;return function(t,a){var r,n,o=[];r=(e.test(a)?t+"/"+a:a).split("/");for(var s=0,i=r.length;i>s;s++)n=r[s],".."===n?o.pop():"."!==n&&""!==n&&o.push(n);return o.join("/")}}(),i=function(e){return e.split("/").slice(0,-1).join("/")},l=function(t){return function(a){var r=s(i(t),a);return e.require(r,t)}},c=function(e,t){var r={id:e,exports:{}};return a[e]=r,t(r.exports,l(e),r),r.exports},d=function(e,n){var i=s(e,".");if(null==n&&(n="/"),i=o(e,n),r.call(a,i))return a[i].exports;if(r.call(t,i))return c(i,t[i]);var l=s(i,"./index");if(r.call(a,l))return a[l].exports;if(r.call(t,l))return c(l,t[l]);throw new Error('Cannot find module "'+e+'" from "'+n+'"')};d.alias=function(e,t){n[t]=e},d.register=d.define=function(e,a){if("object"==typeof e)for(var n in e)r.call(e,n)&&(t[n]=e[n]);else t[e]=a},d.list=function(){var e=[];for(var a in t)r.call(t,a)&&e.push(a);return e},d.brunch=!0,e.require=d}}(),require.register("chart",function(e,t,a){"use strict";function r(){var e=d3.min(C,function(e){return e.date_taken_hostage}),t=d3.max(C,function(e){return e.date_hostage_status_ends});return[Y.parse(e),Y.parse(t)]}function n(e,t){return e=Y.parse(e).getTime()/864e5,t=null==t?(new Date).getTime()/864e5:Y.parse(t).getTime()/864e5,parseInt(new Number(t-e).toFixed(0))}function o(e){C=e.filter(function(e){return null!==e.date_taken_hostage}),C.forEach(function(e,t){C[t].duration=n(e.date_taken_hostage,e.date_hostage_status_ends)}),U=C,E=!0,d3.select("#loader").remove(),d3.select(window).on("resize",q.drawGraph),q.drawGraph()}function s(){k=d3.scale.linear().domain([0,U.length]).range([O.top,A-O.bottom]),m=p.selectAll("g.barGroup").data(U,function(e){return e.id});var e=m.enter().append("g").attr("class","barGroup").attr("index",function(e,t){return e.id}).attr("id",function(e,t){return e.id}).attr("transform",function(e,t){return"translate(0, "+k(t)+")"}).on("click",function(e){});e.append("rect").attr("class","bar").attr("x",0).attr("width",0).attr("height",10).attr("title",function(e){return"event,"+e.id}).style("fillOpacity",.4),e.append("circle").attr("class","point start").attr("cx",0).attr("cy",4.5).attr("r",7),e.filter(function(e){return null!==e.date_hostage_status_ends}).append("circle").attr("class","point end").attr("cx",0).attr("cy",4.5).attr("r",7),e.append("text").attr("class","barLabel").attr("title",function(e){return"event,"+e.id}).attr("data-eventid",function(e){return e.id}).attr("data-toggle","modal").attr("data-target","#moreInfo").attr("y",13).attr("fill","#aaa").on("mouseover",function(e){d3.select(this).attr("fill","black")}).on("mouseout",function(e){d3.select(this).attr("fill","#aaa")}).text(function(e){return e.name}),m.each(function(e,t){B[e.id]=d3.select(this).selectAll(".picto").data(e.concerns_these_hostages.filter(u),function(e){return e.id}),B[e.id].enter().append("circle").attr("class","picto").attr("id",function(e){return e.id}).attr("fill",function(e){return void 0!=e.outcome&&_.contains(M,e.outcome.toLowerCase().trim())?"#575e61":void 0!=e.outcome&&_.contains(j,e.outcome.toLowerCase().trim())?"#87b9db":"#c4bdb5"}).attr("cx",0).attr("cy",7).attr("r",7).attr("display","none"),B[e.id].exit().remove()});var t=m.exit();t.selectAll("rect").remove(),t.selectAll("text").remove(),t.remove()}function i(){switch(UI.currentSort){case"duration":var e=10;e=I/70,d3.select("g.x.axis.top .label").text("Days");break;case"timeline":var e=15;e=I/70,d3.select("g.x.axis.top .label").text("Years");break;case"hostages":var e=10;e=I/70,d3.select("g.x.axis.top .label").text("Number of hostages");break;default:var e=5}h.selectAll("g.x.grid>line").remove(),b.selectAll("g.x.grid>line").data(x.ticks(e)).enter().append("line").attr("class","x").attr("x1",x).attr("x2",x).attr("y1",30).attr("y2",A),g=m.selectAll("rect"),g.transition().attr("x",function(e){switch(UI.currentSort){case"duration":return x(0);case"timeline":return x(Y.parse(e.date_taken_hostage));case"hostages":return x(0)}}).attr("width",function(e){switch(UI.currentSort){case"duration":return x(e.duration);case"timeline":return null==e.date_hostage_status_ends?x(new Date)-x(Y.parse(e.date_taken_hostage)):x(Y.parse(e.date_hostage_status_ends))-x(Y.parse(e.date_taken_hostage));case"hostages":}}).duration(250).delay(0).ease("linear").attr("display",function(){switch(UI.currentSort){case"timeline":return"block";case"duration":return"block";default:return"none"}}),m.selectAll(".point.start").transition().attr("cx",function(e){switch(UI.currentSort){case"duration":return x(0);case"timeline":return x(Y.parse(e.date_taken_hostage));case"hostages":return x(0)}}).attr("display",function(){switch(UI.currentSort){case"timeline":return"block";case"duration":return"block";default:return"none"}}),m.selectAll(".point.end").transition().attr("cx",function(e){switch(UI.currentSort){case"duration":return x(e.duration);case"timeline":return x(Y.parse(e.date_hostage_status_ends));case"hostages":return x(0)}}).attr("display",function(){switch(UI.currentSort){case"timeline":return"block";case"duration":return"block";default:return"none"}}),v=m.selectAll("text"),v.transition().attr("x",function(e){switch(UI.currentSort){case"duration":return x(e.duration)+15;case"timeline":return null==e.date_hostage_status_ends?x(Y.parse(e.date_taken_hostage))-15:x(Y.parse(e.date_taken_hostage))<=I/3?15+x(Y.parse(e.date_hostage_status_ends)):x(Y.parse(e.date_taken_hostage))-15;case"hostages":return x(e.concerns_these_hostages.filter(u).length)+30}}).attr("text-anchor",function(e){switch(UI.currentSort){case"duration":return"start";case"timeline":return x(Y.parse(e.date_taken_hostage))<=I/3?"start":"end";case"hostages":return"start"}}).duration(250).delay(0).ease("linear"),m.each(function(e){B[e.id].sort(function(e,t){return d3.descending(q.filterPictosByOutcome(e),q.filterPictosByOutcome(t))||d3.descending(q.filterPictosByUnknownOutcome(e),q.filterPictosByUnknownOutcome(t))}).transition().attr("cx",function(t,a){switch(UI.currentSort){case"duration":return 10+x(e.duration)+17*a;case"timeline":return null==e.date_hostage_status_ends?10+x(new Date)+15*a:10+x(Y.parse(e.date_hostage_status_ends))+17*a;case"hostages":return x(a+1)}}).delay(0).ease("linear").attr("display",function(){switch(UI.currentSort){case"hostages":return"block";default:return"none"}})})}function l(e){if(UI.currentSort=e,UI.toggleActive(UI.currentSort,"sort"),0==E)return!1;switch(T(),UI.changeUrl(),e){case"duration":var t=d3.max(U,function(e){return e.duration});y=[0,t+t/3],x=d3.scale.linear().domain(y).rangeRound([0,I-O.left-O.right]),w=d3.svg.axis().scale(x).orient("bottom").ticks(I/100).tickSize(2).tickPadding(8),h.selectAll("g.x.axis").call(w),h.selectAll("g.barGroup").sort(function(e,t){return t.duration-e.duration}).transition().attr("transform",function(e,t){return"translate(0, "+k(t)+")"}),d3.selectAll(".legend-locations").classed("nocolor",!1),d3.selectAll(".legend-hostages").style("display","none"),i();break;case"timeline":y=r(),x=d3.time.scale().domain(y).rangeRound([0,I-O.left-O.right]),w=d3.svg.axis().scale(x).orient("bottom").ticks(I/100).tickFormat(G).tickSize(2).tickPadding(8),h.selectAll("g.x.axis").call(w),h.selectAll("g.barGroup").sort(function(e,t){return Y.parse(e.date_taken_hostage)-Y.parse(t.date_taken_hostage)}).transition().attr("transform",function(e,t){return"translate(0, "+k(t)+")"}),d3.selectAll(".legend-locations").classed("nocolor",!1),d3.selectAll(".legend-hostages").style("display","none"),i();break;case"hostages":x=d3.scale.linear().domain([1,30]).rangeRound([0,I-O.left-O.right]),w=d3.svg.axis().scale(x).orient("bottom").ticks(I/150).tickSize(2).tickPadding(8),h.selectAll("g.x.axis").call(w),h.selectAll("g.barGroup").sort(function(e,t){var a=t.concerns_these_hostages.filter(q.filterPictosByOutcome).length,r=e.concerns_these_hostages.filter(q.filterPictosByOutcome).length,n=t.concerns_these_hostages.filter(q.filterPictosByUnknownOutcome).length,o=e.concerns_these_hostages.filter(q.filterPictosByUnknownOutcome).length,s=t.concerns_these_hostages.length,i=e.concerns_these_hostages.length;return a!==r?d3.ascending(a,r):n!==o?d3.ascending(n,o):d3.ascending(s,i)}).transition().attr("transform",function(e,t){return"translate(0, "+k(t)+")"}),d3.selectAll(".legend-locations").classed("nocolor",!0),d3.selectAll(".legend-hostages").style("display","block"),i()}}function c(e){switch(UI.currentColor=e,e){case"locations":h.selectAll("g.barGroup>rect.bar").attr("fill",function(e){return UI.countriesColored[e.happened_in[0]]}),h.selectAll("g.barGroup>.point").attr("fill",function(e){return UI.countriesColored[e.happened_in[0]]})}}function d(e){switch(UI.nationalitySelected){case"all":return!0;default:var t=!1;return e.is_citizen_of.forEach(function(e){UI.nationalitySelected==e&&(t=!0)}),t}}function u(e){var t=new RegExp(UI.search,"i");if(1==d(e)&&(null==UI.search||1==t.test(e.name)||1==t.test($(e.name))||1==t.test(e.profession_activity)||1==t.test(e.profession_activity)))return!0;var a;return 1==a}function f(){U="all"==UI.nationalitySelected?C:C.filter(function(e){var t;return e.concerns_these_hostages.forEach(function(e){t=d(e)}),1==t}),null!==UI.search&&(U=U.filter(function(e){var t=new RegExp(UI.search,"i");if(1==t.test(e.name)||1==t.test($(e.name)))return!0;var a;return e.concerns_these_hostages.forEach(function(e){(1==t.test(e.name)||1==t.test($(e.name))||1==t.test(e.profession_activity)||1==t.test(e.profession_activity))&&(a=!0)}),e.happened_in.forEach(function(e){(1==t.test(e)||1==t.test($(e))||1==t.test(e.profession_activity)||1==t.test(e.profession_activity))&&(a=!0)}),1==a})),null!==UI.locations_filtered&&(U=U.filter(function(e){var t;return e.happened_in.forEach(function(e,a){UI.locations_filtered.indexOf(e)>-1&&(t=!0)}),1==t}))}var h,p,m,g,v,b,y,x,w,k,I,A,C,U,S=d3.select("#dataviz"),L=S.append("svg"),B={},E=!1,O={top:30,right:50,bottom:25,left:15},P=function(){I=S[0][0].offsetWidth},T=function(){P(),A=20*U.length+60,d3.select("g.x.axis.bottom").attr("transform","translate(0,"+A+")"),L.attr("width",I).attr("height",A+30)},Y=d3.time.format("%Y-%m-%dT%H:%M:%S"),G=(d3.time.format("%B %Y"),d3.time.format("%Y")),M=["dead","dead (unknown)","death","dead (attempted rescue)","dead (executed)","executed","dead (illness)","died from an infection","killed","murdered","dead (killed)"],j=["freed","escape","freed (released)","liberation","freed, injured","freed (escaped)","freedom","freed (realesed)","liberated for medical reasons","freed (liberated)","freed ( released)","liberated","released","release","liberated (released)","freed (unknown)"],z={"á":"a","ö":"o","ï":"i","é":"e","è":"e","ê":"e"},$=function(e){for(var t="",a=0;a<e.length;a++)t+=z[e.charAt(a)]||e.charAt(a);return t};P(),h=L.append("g").attr("transform","translate("+O.left+", "+O.top+")").attr("class","chart"),h.append("g").attr("class","x axis top"),h.append("g").attr("class","x axis bottom"),d3.select("g.x.axis.top").append("text").attr("class","label").text("Years"),b=h.append("g").attr("class","grid x"),p=h.append("g").attr("class","groups");var q={init:function(e){o(e)},drawGraph:function(){return 0==E?!1:(f(),T(),s(),l(UI.currentSort),void c(UI.currentColor))},filterPictosByOutcome:function(e){return void 0!==e.outcome?1==_.contains(M,e.outcome.toLowerCase().trim()):!1},filterPictosByUnknownOutcome:function(e){return void 0!==e.outcome&&0==_.contains(j,e.outcome.toLowerCase().trim())&&0==_.contains(M,e.outcome.toLowerCase().trim())?!0:!1},sortBy:function(e){l(e)},data_indexed:null,deathList:M,freeList:j};a.exports=q}),require.register("map",function(e,t,a){"use strict";function r(e){var t=e.getDisplayed(),a=document.getElementById("displayed-list");a.innerHTML="",t.forEach(function(e){var t=document.createElement("li");t.innerHTML=e.properties.name,t.setAttribute("data-eventId",e.properties.id),t.setAttribute("data-toggle","modal"),t.setAttribute("data-target","#moreInfo"),a.appendChild(t)})}function n(e){e.features.forEach(function(t,a){void 0!==Chart.data_indexed[t.properties.id]&&(e.features[a].properties.id=parseInt(t.properties.id),e.features[a].properties.name=Chart.data_indexed[t.properties.id].name,e.features[a].properties.start=Chart.data_indexed[t.properties.id].date_taken_hostage,null==Chart.data_indexed[t.properties.id].date_hostage_status_ends?e.features[a].properties.end=new Date:e.features[a].properties.end=Chart.data_indexed[t.properties.id].date_hostage_status_ends)});var t=L.timeline(e,{formatDate:function(e){return moment(e).format("YYYY")},pointToLayer:function(e,t){return L.circleMarker(t,{radius:3*Math.sqrt(Chart.data_indexed[e.properties.id].concerns_these_hostages.length*Math.PI),color:"#fff",fillColor:"#0096c7",opacity:1,fillOpacity:1})},position:"bottomleft",waitToUpdateMap:!1,showTicks:!0,enablePlayback:!0});t.addTo(o),t.on("change",function(e){r(e.target)}),t.on("click",function(e){UI.moreInfoId=e.layer.feature.properties.id,$("#moreInfo").modal(e)}),r(t),d3.select("#loader").remove()}L.mapbox.accessToken="pk.eyJ1IjoiYWdlbmNlZnJhbmNlcHJlc3NlIiwiYSI6Ijk5YjI2NGE0MDdlYTE1NGY5ZjVjYmMwYjJmNjY3ZWJlIn0.crFebhJyP1aJ7uY2B12C2A";var o=L.mapbox.map("leafletMap","agencefrancepresse.6906a779",{center:new L.LatLng(29,16),maxBounds:[[84,149],[-76,-133]],maxZoom:5,minZoom:1,zoomControl:!1,legendControl:{position:"topleft"}});d3.select("#map")[0][0].offsetWidth>460?o.setZoom(2):o.setZoom(1),o.scrollWheelZoom.disable(),new L.Control.Zoom({position:"topright"}).addTo(o),o.legendControl.addLegend(document.getElementById("mapInfo").innerHTML);var s={init:function(e){n(e)},resize:function(){o.invalidateSize()}};a.exports=s}),require.register("ui",function(e,t,a){"use strict";function r(e){var t=new RegExp("/","g");return null!==e&&void 0!==e&&(e=e.replace(t,"")),e}function n(e){return" "+e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function o(e,t,a){var r,n;r=window.screen.width/2-(t/2+10),n=window.screen.height/2-(a/2+50);var o="status=no,height="+a+",width="+t+",resizable=yes,left="+r+",top="+n+",screenX="+r+",screenY="+n+",toolbar=no,menubar=no,scrollbars=no,location=no,directories=no";return window.open(e.href,"sharer",o),!1}var s=new URI(window.location.href),i={url:s,currentSort:s.search(!0).sort||"timeline",currentColor:"locations",nationalitySelected:r(s.search(!0).nationality)||"all",search:r(s.search(!0).search)||null,locations_filtered:s.search(!0).locations||null,countriesColored:{},moreInfoId:null,toggleActive:function(e,t){d3.selectAll("."+t).classed("active",0),d3.selectAll("."+e).classed("active",1),_gaq.push(["_trackEvent","tabs","show",e])},changeUrl:function(){if(i.url.setSearch({sort:i.currentSort,locations:i.locations_filtered,nationality:i.nationalitySelected}),"undefined"!=typeof history.pushState){var e={Title:$(document).find("title").text(),Url:i.url.resource()};history.pushState(e,e.Title,e.Url)}else console.warn("Browser does not support HTML5.")}};"map"==i.currentSort?$('#tabs a[href="#map"]').tab("show"):"about"==i.currentSort?$('#tabs a[href="#about"]').tab("show"):$('#tabs a[href="#data"]').tab("show"),$("nav li a").on("click",function(){return $(this).tab("show"),Chart.sortBy(this.getAttribute("data-tabtarget")),"map"==this.dataset.tabtarget&&void 0!==Map&&Map.resize(),!1}),"hidden"==i.url.search(!0).header&&(d3.select("header").style("display","none"),d3.select(".menu-block").style("display","none"),d3.select(".legend").style("display","none"),d3.select(".source").style("display","block"));var l=[{name:"North Africa",countries:["algeria","egypt","tunisia","libya","sudan"],color:"#ffe17e"},{name:"West Africa",countries:["ivory coast","mali","niger","nigeria","mauritania"],color:"#f1923f"},{name:"Central Africa",countries:["angola","cameroon","central african republic","chad","democratic republic of congo"],color:"#de9f6b"},{name:"East Africa",countries:["ethiopia","kenya","rwanda","seychelles","somalia","south sudan"],color:"#a17457"},{name:"Middle East",countries:["turkey","lebanon","iraq","syria","palestine","israel","yemen","saudi arabia"],color:"#6269ad"},{name:"South America",countries:["colombia","venezuela","guatemala","mexico"],color:"#6db6a6"},{name:"Russia-Georgia",countries:["russia","georgia"],color:"#ee8280"},{name:"Asia",countries:["pakistan","afghanistan","philippines","india","cambodia"],color:"#afaaa2"}];l.forEach(function(e,t){e.countries.forEach(function(t,a){i.countriesColored[t]=e.color})}),d3.select("ul.legend-locations").selectAll(".legend-locations li").data(l).enter().append("li").attr("title",function(e){return e.countries.map(n).concat()}).text(function(e){return e.name}).on("click",function(e){i.locations_filtered==e.countries?(i.locations_filtered=null,d3.select("ul.legend-locations li.selected").classed("selected",!1),d3.selectAll("ul.legend-locations,.removeFilters").classed("selected",!1)):(d3.selectAll("ul.legend-locations,.removeFilters").classed("selected",!0),d3.select("ul.legend-locations li.selected").classed("selected",!1),d3.select(this).classed("selected",!0),i.locations_filtered=e.countries),Chart.drawGraph()}).append("span").style("background",function(e){return e.color}),$(".removeFilters").on("click",function(){i.locations_filtered=null,d3.select("ul.legend-locations li.selected").classed("selected",!1),d3.selectAll("ul.legend-locations,.removeFilters").classed("selected",!1),Chart.drawGraph()}),null!==i.locations_filtered&&d3.selectAll(".legend-locations li").each(function(e){e.countries[0]==i.locations_filtered[0]&&(d3.selectAll("ul.legend-locations,.removeFilters").classed("selected",!0),d3.select(this).attr("class","selected"))}),d3.select("#countries").on("change",function(){i.nationalitySelected=this.options[this.selectedIndex].value,Chart.drawGraph()}),void 0!==i.url.search(!0).nationality&&d3.select("#countries option[value="+i.nationalitySelected+"]").attr("selected","selected"),d3.select("#search").attr("value",i.search),$("#moreInfo").on("show.bs.modal",function(e){if(void 0!==e.relatedTarget)var t=e.relatedTarget.__data__.id,a=Chart.data_indexed[t];else var a=Chart.data_indexed[i.moreInfoId];var r;r=a.duration<=1?"a day or less":moment.duration(a.duration,"days").humanize();var n='<div class="listHostages row">';a.concerns_these_hostages.sort(function(e,t){return d3.descending(Chart.filterPictosByOutcome(e),Chart.filterPictosByOutcome(t))||d3.descending(Chart.filterPictosByUnknownOutcome(e),Chart.filterPictosByUnknownOutcome(t))}).forEach(function(e,t){n+='<div class="col-xs-12 col-sm-6 col-lg-6">'+e.name.split("[")[0].trim(),n+=void 0!=e.outcome&&_.contains(Chart.deathList,e.outcome.toLowerCase().trim())?' <span class="label label-default">'+e.outcome+"</span>":void 0!=e.outcome&&_.contains(Chart.freeList,e.outcome.toLowerCase().trim())?' <span class="label label-primary">'+e.outcome+"</span>":' <span class="label label-warning">'+e.outcome+"</span>",n+="</div>"}),n+="</div>";var o=a.name;_gaq.push(["_trackEvent","modal","show",a.name]);var s=$(this);s.find(".modal-header").css("background-color",i.countriesColored[a.happened_in[0]]),s.find(".modal-title").html(o),s.find(".duration").text(r),s.find(".hostages").html(n),s.find(".modal-body .description").html(a.description)});var c;d3.select("#search").on("input",function(e){var t=this;clearTimeout(c),c=setTimeout(function(){t.value.length>=3&&(i.search=t.value,i.url.setSearch({search:i.search}),Chart.drawGraph()),0==t.value.length&&(i.search=null,i.url.removeSearch("search"),Chart.drawGraph())},300)}),$("#twitterButton a,#facebookButton a").on("click",function(){return o(this,700,300),!1}),a.exports=i});