!function(){"use strict";var e="undefined"==typeof window?global:window;if("function"!=typeof e.require){var t={},r={},n={}.hasOwnProperty,a={},o=function(e,t){var r=0;t&&(t.indexOf(!1)&&(r="components/".length),t.indexOf("/",r)>0&&(t=t.substring(r,t.indexOf("/",r))));var n=a[e+"/index.js"]||a[t+"/deps/"+e+"/index.js"];return n?"components/"+n.substring(0,n.length-".js".length):e},s=function(){var e=/^\.\.?(\/|$)/;return function(t,r){var n,a,o=[];n=(e.test(r)?t+"/"+r:r).split("/");for(var s=0,i=n.length;i>s;s++)a=n[s],".."===a?o.pop():"."!==a&&""!==a&&o.push(a);return o.join("/")}}(),i=function(e){return e.split("/").slice(0,-1).join("/")},c=function(t){return function(r){var n=s(i(t),r);return e.require(n,t)}},l=function(e,t){var n={id:e,exports:{}};return r[e]=n,t(n.exports,c(e),n),n.exports},d=function(e,a){var i=s(e,".");if(null==a&&(a="/"),i=o(e,a),n.call(r,i))return r[i].exports;if(n.call(t,i))return l(i,t[i]);var c=s(i,"./index");if(n.call(r,c))return r[c].exports;if(n.call(t,c))return l(c,t[c]);throw new Error('Cannot find module "'+e+'" from "'+a+'"')};d.alias=function(e,t){a[t]=e},d.register=d.define=function(e,r){if("object"==typeof e)for(var a in e)n.call(e,a)&&(t[a]=e[a]);else t[e]=r},d.list=function(){var e=[];for(var r in t)n.call(t,r)&&e.push(r);return e},d.brunch=!0,e.require=d}}(),require.register("chart",function(e,t,r){"use strict";function n(){var e=d3.min(C,function(e){return e.date_taken_hostage}),t=d3.max(C,function(e){return e.date_hostage_status_ends});return[Y.parse(e),Y.parse(t)]}function a(e,t){return e=Y.parse(e).getTime()/864e5,t=null==t?(new Date).getTime()/864e5:Y.parse(t).getTime()/864e5,parseInt(new Number(t-e).toFixed(0))}function o(e){C=e.filter(function(e){return null!==e.date_taken_hostage}),C.forEach(function(e,t){C[t].duration=a(e.date_taken_hostage,e.date_hostage_status_ends)}),U=C,E=!0,d3.select("#loader").remove(),d3.select(window).on("resize",N.drawGraph),N.drawGraph()}function s(){k=d3.scale.linear().domain([0,U.length]).range([O.top,A-O.bottom]),m=p.selectAll("g.barGroup").data(U,function(e){return e.id});var e=m.enter().append("g").attr("class","barGroup").attr("index",function(e,t){return e.id}).attr("id",function(e,t){return e.id}).attr("transform",function(e,t){return"translate(0, "+k(t)+")"}).on("click",function(e){});e.append("rect").attr("class","bar").attr("x",0).attr("width",0).attr("title",function(e){return"event,"+e.id}),e.append("circle").attr("class","point start").attr("cx",0).attr("cy",4.5).attr("r",7),e.filter(function(e){return null!==e.date_hostage_status_ends}).append("circle").attr("class","point end").attr("cx",0).attr("cy",4.5).attr("r",7),e.append("text").attr("class","barLabel").attr("title",function(e){return"event,"+e.id}).attr("data-eventid",function(e){return e.id}).attr("data-toggle","modal").attr("data-target","#moreInfo").attr("y",13).attr("fill","#aaa").on("mouseover",function(e){d3.select(this).attr("fill","black")}).on("mouseout",function(e){d3.select(this).attr("fill","#aaa")}).text(function(e){return e.name}),m.each(function(e,t){B[e.id]=d3.select(this).selectAll(".picto").data(e.concerns_these_hostages.filter(u),function(e){return e.id}),B[e.id].enter().append("circle").attr("class","picto").attr("id",function(e){return e.id}).attr("fill",function(e){return void 0!=e.outcome&&_.contains(j,e.outcome.toLowerCase().trim())?"#575e61":void 0!=e.outcome&&_.contains(M,e.outcome.toLowerCase().trim())?"#87b9db":"#c4bdb5"}).attr("cx",0).attr("cy",7).attr("r",7).attr("display","none"),B[e.id].exit().remove()});var t=m.exit();t.selectAll("rect").remove(),t.selectAll("text").remove(),t.remove()}function i(){switch(UI.currentSort){case"duration":var e=10;e=I/70,d3.select("g.x.axis.top .label").text("Days");break;case"timeline":var e=15;e=I/70,d3.select("g.x.axis.top .label").text("Years");break;case"hostages":var e=10;e=I/70,d3.select("g.x.axis.top .label").text("Number of hostages");break;default:var e=5}h.selectAll("g.x.grid>line").remove(),b.selectAll("g.x.grid>line").data(x.ticks(e)).enter().append("line").attr("class","x").attr("x1",x).attr("x2",x).attr("y1",30).attr("y2",A),g=m.selectAll("rect"),g.transition().attr("x",function(e){switch(UI.currentSort){case"duration":return x(0);case"timeline":return x(Y.parse(e.date_taken_hostage));case"hostages":return x(0)}}).attr("width",function(e){switch(UI.currentSort){case"duration":return x(e.duration);case"timeline":return null==e.date_hostage_status_ends?x(new Date)-x(Y.parse(e.date_taken_hostage)):x(Y.parse(e.date_hostage_status_ends))-x(Y.parse(e.date_taken_hostage));case"hostages":}}).duration(250).delay(0).ease("linear").attr("display",function(){switch(UI.currentSort){case"timeline":return"block";case"duration":return"block";default:return"none"}}),m.selectAll(".point.start").transition().attr("cx",function(e){switch(UI.currentSort){case"duration":return x(0);case"timeline":return x(Y.parse(e.date_taken_hostage));case"hostages":return x(0)}}).attr("display",function(){switch(UI.currentSort){case"timeline":return"block";case"duration":return"block";default:return"none"}}),m.selectAll(".point.end").transition().attr("cx",function(e){switch(UI.currentSort){case"duration":return x(e.duration);case"timeline":return x(Y.parse(e.date_hostage_status_ends));case"hostages":return x(0)}}).attr("display",function(){switch(UI.currentSort){case"timeline":return"block";case"duration":return"block";default:return"none"}}),v=m.selectAll("text"),v.transition().attr("x",function(e){switch(UI.currentSort){case"duration":return x(e.duration)+15;case"timeline":return null==e.date_hostage_status_ends?x(Y.parse(e.date_taken_hostage))-15:x(Y.parse(e.date_taken_hostage))<=I/3?15+x(Y.parse(e.date_hostage_status_ends)):x(Y.parse(e.date_taken_hostage))-15;case"hostages":return x(e.concerns_these_hostages.filter(u).length)+30}}).attr("text-anchor",function(e){switch(UI.currentSort){case"duration":return"start";case"timeline":return x(Y.parse(e.date_taken_hostage))<=I/3?"start":"end";case"hostages":return"start"}}).duration(250).delay(0).ease("linear"),m.each(function(e){B[e.id].sort(function(e,t){return d3.descending(N.filterPictosByOutcome(e),N.filterPictosByOutcome(t))||d3.descending(N.filterPictosByUnknownOutcome(e),N.filterPictosByUnknownOutcome(t))}).transition().attr("cx",function(t,r){switch(UI.currentSort){case"duration":return 10+x(e.duration)+17*r;case"timeline":return null==e.date_hostage_status_ends?10+x(new Date)+15*r:10+x(Y.parse(e.date_hostage_status_ends))+17*r;case"hostages":return x(r+1)}}).delay(0).ease("linear").attr("display",function(){switch(UI.currentSort){case"hostages":return"block";default:return"none"}})})}function c(e){if(UI.currentSort=e,UI.toggleActive(UI.currentSort,"sort"),0==E)return!1;switch(T(),UI.changeUrl(),e){case"duration":var t=d3.max(U,function(e){return e.duration});y=[0,t+t/3],x=d3.scale.linear().domain(y).rangeRound([0,I-O.left-O.right]),w=d3.svg.axis().scale(x).orient("bottom").ticks(I/100).tickSize(2).tickPadding(8),h.selectAll("g.x.axis").call(w),h.selectAll("g.barGroup").sort(function(e,t){return t.duration-e.duration}).transition().attr("transform",function(e,t){return"translate(0, "+k(t)+")"}),d3.selectAll(".legend-locations").classed("nocolor",!1),d3.selectAll(".legend-hostages").style("display","none"),i();break;case"timeline":y=n(),x=d3.time.scale().domain(y).rangeRound([0,I-O.left-O.right]),w=d3.svg.axis().scale(x).orient("bottom").ticks(I/100).tickFormat(G).tickSize(2).tickPadding(8),h.selectAll("g.x.axis").call(w),h.selectAll("g.barGroup").sort(function(e,t){return Y.parse(e.date_taken_hostage)-Y.parse(t.date_taken_hostage)}).transition().attr("transform",function(e,t){return"translate(0, "+k(t)+")"}),d3.selectAll(".legend-locations").classed("nocolor",!1),d3.selectAll(".legend-hostages").style("display","none"),i();break;case"hostages":x=d3.scale.linear().domain([1,30]).rangeRound([0,I-O.left-O.right]),w=d3.svg.axis().scale(x).orient("bottom").ticks(I/150).tickSize(2).tickPadding(8),h.selectAll("g.x.axis").call(w),h.selectAll("g.barGroup").sort(function(e,t){var r=t.concerns_these_hostages.filter(N.filterPictosByOutcome).length,n=e.concerns_these_hostages.filter(N.filterPictosByOutcome).length,a=t.concerns_these_hostages.filter(N.filterPictosByUnknownOutcome).length,o=e.concerns_these_hostages.filter(N.filterPictosByUnknownOutcome).length,s=t.concerns_these_hostages.length,i=e.concerns_these_hostages.length;return r!==n?d3.ascending(r,n):a!==o?d3.ascending(a,o):d3.ascending(s,i)}).transition().attr("transform",function(e,t){return"translate(0, "+k(t)+")"}),d3.selectAll(".legend-locations").classed("nocolor",!0),d3.selectAll(".legend-hostages").style("display","block"),i()}}function l(e){switch(UI.currentColor=e,e){case"locations":h.selectAll("g.barGroup>rect").attr("fill",function(e){return UI.countriesColored[e.happened_in[0]]}),h.selectAll("g.barGroup>.point").attr("fill",function(e){return UI.countriesColored[e.happened_in[0]]})}}function d(e){switch(UI.nationalitySelected){case"all":return!0;default:var t=!1;return e.is_citizen_of.forEach(function(e){UI.nationalitySelected==e&&(t=!0)}),t}}function u(e){var t=new RegExp(search,"i");if(1==d(e)&&(null==search||1==t.test(e.name)||1==t.test($(e.name))||1==t.test(e.profession_activity)||1==t.test(e.profession_activity)))return!0;var r;return 1==r}function f(){U="all"==UI.nationalitySelected?C:C.filter(function(e){var t;return e.concerns_these_hostages.forEach(function(e){t=d(e)}),1==t}),null!==UI.search&&(U=U.filter(function(e){var t=new RegExp(UI.search,"i");if(1==t.test(e.name)||1==t.test($(e.name)))return!0;var r;return e.concerns_these_hostages.forEach(function(e){(1==t.test(e.name)||1==t.test($(e.name))||1==t.test(e.profession_activity)||1==t.test(e.profession_activity))&&(r=!0)}),e.happened_in.forEach(function(e){(1==t.test(e)||1==t.test($(e))||1==t.test(e.profession_activity)||1==t.test(e.profession_activity))&&(r=!0)}),1==r})),null!==UI.locations_filtered&&(U=U.filter(function(e){var t;return e.happened_in.forEach(function(e,r){UI.locations_filtered.indexOf(e)>-1&&(t=!0)}),1==t}))}var h,p,m,g,v,b,y,x,w,k,I,A,C,U,S=d3.select("#dataviz"),L=S.append("svg"),B={},E=!1,O={top:30,right:50,bottom:25,left:15},P=function(){I=S[0][0].offsetWidth},T=function(){P(),A=20*U.length+60,d3.select("g.x.axis.bottom").attr("transform","translate(0,"+A+")"),L.attr("width",I).attr("height",A+100)},Y=d3.time.format("%Y-%m-%dT%H:%M:%S"),G=(d3.time.format("%B %Y"),d3.time.format("%Y")),j=["dead","dead (unknown)","death","dead (attempted rescue)","dead (executed)","executed","dead (illness)","died from an infection","killed","murdered"],M=["freed","escape","freed (released)","liberation","freed, injured","freed (escaped)","freedom","freed (realesed)","liberated for medical reasons","freed (liberated)","freed ( released)","liberated","released","release","liberated (released)","freed (unknown)"],z={"á":"a","ö":"o","ï":"i","é":"e","è":"e","ê":"e"},$=function(e){for(var t="",r=0;r<e.length;r++)t+=z[e.charAt(r)]||e.charAt(r);return t};P(),h=L.append("g").attr("transform","translate("+O.left+", "+O.top+")").attr("class","chart"),h.append("g").attr("class","x axis top"),h.append("g").attr("class","x axis bottom"),d3.select("g.x.axis.top").append("text").attr("class","label").text("Years"),b=h.append("g").attr("class","grid x"),p=h.append("g").attr("class","groups");var N={init:function(e){o(e)},drawGraph:function(){return 0==E?!1:(f(),T(),s(),c(UI.currentSort),void l(UI.currentColor))},filterPictosByOutcome:function(e){return void 0!==e.outcome?1==_.contains(j,e.outcome.toLowerCase().trim()):!1},filterPictosByUnknownOutcome:function(e){return void 0!==e.outcome&&0==_.contains(M,e.outcome.toLowerCase().trim())&&0==_.contains(j,e.outcome.toLowerCase().trim())?!0:!1},sortBy:function(e){c(e)},data_indexed:null,deathList:j,freeList:M};r.exports=N}),require.register("map",function(e,t,r){"use strict";function n(e){var t=e.getDisplayed(),r=document.getElementById("displayed-list");r.innerHTML="",t.forEach(function(e){var t=document.createElement("li");t.innerHTML=e.properties.name,t.setAttribute("data-eventId",e.properties.id),t.setAttribute("data-toggle","modal"),t.setAttribute("data-target","#moreInfo"),r.appendChild(t)})}function a(e){e.features.forEach(function(t,r){e.features[r].properties.id=parseInt(t.properties.id),e.features[r].properties.name=Chart.data_indexed[t.properties.id].name,e.features[r].properties.start=Chart.data_indexed[t.properties.id].date_taken_hostage,e.features[r].properties.end=Chart.data_indexed[t.properties.id].date_hostage_status_ends,null==e.features[r].properties.end&&(e.features[r].properties.end=new Date)});var t=L.timeline(e,{formatDate:function(e){return moment(e).format("YYYY")},pointToLayer:function(e,t){return L.circleMarker(t,{radius:3*Math.sqrt(Chart.data_indexed[e.properties.id].concerns_these_hostages.length*Math.PI),color:"#fff",fillColor:"#0096c7",opacity:1,fillOpacity:1})},duration:1,position:"bottomleft"});t.addTo(o),t.on("change",function(e){n(e.target)}),n(t),d3.select("#loader").remove()}L.mapbox.accessToken="pk.eyJ1IjoiYWdlbmNlZnJhbmNlcHJlc3NlIiwiYSI6Ijk5YjI2NGE0MDdlYTE1NGY5ZjVjYmMwYjJmNjY3ZWJlIn0.crFebhJyP1aJ7uY2B12C2A";var o=L.mapbox.map("leafletMap","agencefrancepresse.6906a779",{center:new L.LatLng(29,16),maxBounds:[[84,149],[-76,-133]],maxZoom:5,minZoom:1,zoomControl:!1,legendControl:{position:"topleft"}});d3.select("#map")[0][0].offsetWidth>460?o.setZoom(2):o.setZoom(1),o.scrollWheelZoom.disable(),new L.Control.Zoom({position:"topright"}).addTo(o),o.legendControl.addLegend(document.getElementById("mapInfo").innerHTML);var s={init:function(e){a(e)},resize:function(){o.invalidateSize()}};r.exports=s}),require.register("ui",function(e,t,r){"use strict";function n(e){var t=new RegExp("/","g");return null!==e&&void 0!==e&&(e=e.replace(t,"")),e}function a(e){return" "+e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function o(e,t,r){var n,a;n=window.screen.width/2-(t/2+10),a=window.screen.height/2-(r/2+50);var o="status=no,height="+r+",width="+t+",resizable=yes,left="+n+",top="+a+",screenX="+n+",screenY="+a+",toolbar=no,menubar=no,scrollbars=no,location=no,directories=no";return window.open(e.href,"sharer",o),!1}var s=new URI(window.location.href),i={url:s,currentSort:s.search(!0).sort||"timeline",currentColor:"locations",nationalitySelected:n(s.search(!0).nationality)||"all",search:n(s.search(!0).search)||null,locations_filtered:s.search(!0).locations||null,countriesColored:{},moreInfoId:null,toggleActive:function(e,t){d3.selectAll("."+t).classed("active",0),d3.selectAll("."+e).classed("active",1)},changeUrl:function(){if(i.url.setSearch({sort:i.currentSort,locations:i.locations_filtered,nationality:i.nationalitySelected}),"undefined"!=typeof history.pushState){var e={Title:$(document).find("title").text(),Url:i.url.resource()};history.pushState(e,e.Title,e.Url)}else console.warn("Browser does not support HTML5.")}};"map"==i.currentSort?$('#tabs a[href="#map"]').tab("show"):"about"==i.currentSort?$('#tabs a[href="#about"]').tab("show"):$('#tabs a[href="#data"]').tab("show"),$("nav li a").on("click",function(){return $(this).tab("show"),Chart.sortBy(this.dataset.tabtarget),"map"==this.dataset.tabtarget&&void 0!==Map&&Map.resize(),!1}),"hidden"==i.url.search(!0).header&&(d3.select("header").style("display","none"),d3.select(".menu-block").style("display","none"),d3.select(".legend").style("display","none"),d3.select(".source").style("display","none"));var c=[{name:"North Africa",countries:["algeria","egypt","tunisia","libya","sudan"],color:"#ffe17e"},{name:"West Africa",countries:["ivory coast","mali","niger","nigeria","mauritania"],color:"#f1923f"},{name:"Central Africa",countries:["angola","cameroon","central african republic","chad","democratic republic of congo"],color:"#de9f6b"},{name:"East Africa",countries:["ethiopia","kenya","rwanda","seychelles","somalia","south sudan"],color:"#a17457"},{name:"Middle East",countries:["turkey","lebanon","iraq","syria","palestine","israel","yemen","saudi arabia"],color:"#6269ad"},{name:"South America",countries:["colombia","venezuela","guatemala","mexico"],color:"#6db6a6"},{name:"Russia-Georgia",countries:["russia","georgia"],color:"#ee8280"},{name:"Asia",countries:["pakistan","afghanistan","philippines","india","cambodia"],color:"#afaaa2"}];c.forEach(function(e,t){e.countries.forEach(function(t,r){i.countriesColored[t]=e.color})}),d3.select("ul.legend-locations").selectAll(".legend-locations li").data(c).enter().append("li").attr("title",function(e){return e.countries.map(a).concat()}).text(function(e){return e.name}).on("click",function(e){i.locations_filtered==e.countries?(i.locations_filtered=null,d3.select("ul.legend-locations li.selected").classed("selected",!1),d3.selectAll("ul.legend-locations,.removeFilters").classed("selected",!1)):(d3.selectAll("ul.legend-locations,.removeFilters").classed("selected",!0),d3.select("ul.legend-locations li.selected").classed("selected",!1),d3.select(this).classed("selected",!0),i.locations_filtered=e.countries),Chart.drawGraph()}).append("span").style("background",function(e){return e.color}),$(".removeFilters").on("click",function(){i.locations_filtered=null,d3.select("ul.legend-locations li.selected").classed("selected",!1),d3.selectAll("ul.legend-locations,.removeFilters").classed("selected",!1),Chart.drawGraph()}),null!==i.locations_filtered&&d3.selectAll(".legend-locations li").each(function(e){e.countries[0]==i.locations_filtered[0]&&(d3.selectAll("ul.legend-locations,.removeFilters").classed("selected",!0),d3.select(this).attr("class","selected"))}),d3.select("#countries").on("change",function(){i.nationalitySelected=this.options[this.selectedIndex].value,Chart.drawGraph()}),void 0!==i.url.search(!0).nationality&&d3.select("#countries option[value="+i.nationalitySelected+"]").attr("selected","selected"),d3.select("#search").attr("value",i.search),$("#moreInfo").on("show.bs.modal",function(e){if(void 0!==e.relatedTarget)var t=e.relatedTarget.dataset.eventid,r=Chart.data_indexed[t];else var r=Chart.data_indexed[i.moreInfoId];var n;n=r.duration<=1?"a day or less":moment.duration(r.duration,"days").humanize();var a='<div class="listHostages row">';r.concerns_these_hostages.sort(function(e,t){return d3.descending(Chart.filterPictosByOutcome(e),Chart.filterPictosByOutcome(t))||d3.descending(Chart.filterPictosByUnknownOutcome(e),Chart.filterPictosByUnknownOutcome(t))}).forEach(function(e,t){a+='<div class="col-xs-12 col-sm-6 col-lg-6">'+e.name.split("[")[0].trim(),a+=void 0!=e.outcome&&_.contains(Chart.deathList,e.outcome.toLowerCase().trim())?' <span class="label label-default">'+e.outcome+"</span>":void 0!=e.outcome&&_.contains(Chart.freeList,e.outcome.toLowerCase().trim())?' <span class="label label-primary">'+e.outcome+"</span>":' <span class="label label-warning">'+e.outcome+"</span>",a+="</div>"}),a+="</div>";var o='<a target="_blank" href="https://www.detective.io/afp/hostage-project/contribute/?type=hostageevent&id='+r.id+'">'+r.name+"</a>",s=$(this);s.find(".modal-header").css("background-color",i.countriesColored[r.happened_in[0]]),s.find(".modal-title").html(o),s.find(".duration").text(n),s.find(".hostages").html(a),s.find(".modal-body .description").html(r.description)});var l;d3.select("#search").on("input",function(e){var t=this;clearTimeout(l),l=setTimeout(function(){t.value.length>=3&&(i.search=t.value,i.url.setSearch({search:i.search}),Chart.drawGraph()),0==t.value.length&&(i.search=null,i.url.removeSearch("search"),Chart.drawGraph())},300)}),$("#twitterButton a,#facebookButton a").on("click",function(){return o(this,700,300),!1}),r.exports=i});